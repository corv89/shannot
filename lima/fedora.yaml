# Lima VM Template for Fedora
# Minimal template with externalized provisioning scripts
# Provisioning logic is in lima/scripts/ directory, executed from Lima-mounted source dir

vmType: "vz"
arch: "aarch64"
cpus: 12
memory: "8G"
disk: "32G"

images:
  - location: "https://download.fedoraproject.org/pub/fedora/linux/releases/42/Cloud/aarch64/images/Fedora-Cloud-Base-Generic-42-1.1.aarch64.qcow2"
    arch: "aarch64"

mounts:
  - location: "././"
    writable: true
  - location: "/tmp/lima"
    writable: true

ssh:
  localPort: 0
  loadDotSSHPubKeys: true
  forwardAgent: false

containerd:
  system: false
  user: false

provision:
  - mode: system
    script: |
      #!/bin/bash
      set -eu

      # Run system provisioning scripts
      bash "lima/scripts/setup-dnf-mirrors.sh"
      bash "lima/scripts/setup-proxy.sh"
      bash "lima/scripts/setup-registry-mirrors.sh"

      # Install required packages
      dnf install -y bubblewrap

  - mode: user
    script: |
      #!/bin/bash
      set -eu

      # Run user provisioning scripts
      bash "lima/scripts/setup-user-env.sh"

firmware:
  legacyBIOS: false

video:
  display: "none"

audio:
  device: "none"

rosetta:
  enabled: false
  binfmt: false
